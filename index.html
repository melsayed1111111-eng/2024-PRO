<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù„Ø¹Ø¨Ø© 2048 - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©</title>

    <!-- Ø§Ù„Ø®Ø·ÙˆØ· -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">

    <style>
        /* --- CSS Variables --- */
        
         :root {
            --bg-color: #faf8ef;
            --grid-bg: #bbada0;
            --cell-bg: rgba(238, 228, 218, 0.35);
            --text-dark: #776e65;
            --primary-btn: #8f7a66;
            --undo-btn: #e67e22;
            --store-btn: #27ae60;
        }
        
        body {
            margin: 0;
            padding: 0;
            font-family: 'Tajawal', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-dark);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            user-select: none;
            /* Ù…Ù†Ø¹ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†Øµ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨ */
        }
        /* --- Ø§Ù„Ù‡ÙŠØ¯Ø± ÙˆØ§Ù„Ù†Ù‚Ø§Ø· --- */
        
        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 90%;
            max-width: 500px;
            margin-top: 20px;
        }
        
        .title {
            font-size: 60px;
            font-weight: 900;
            margin: 0;
            color: var(--text-dark);
        }
        
        .scores-container {
            display: flex;
            gap: 5px;
        }
        
        .score-box {
            background: #bbada0;
            padding: 10px 20px;
            border-radius: 6px;
            color: white;
            text-align: center;
            min-width: 70px;
        }
        
        .score-label {
            font-size: 12px;
            opacity: 0.8;
            text-transform: uppercase;
        }
        
        .score-val {
            font-size: 20px;
            font-weight: bold;
        }
        /* --- Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­ÙƒÙ… (Ø§Ù„Ù…ØªØ¬Ø± ÙˆØ§Ù„ØªØ±Ø§Ø¬Ø¹) --- */
        
        .controls-bar {
            display: flex;
            justify-content: space-between;
            width: 90%;
            max-width: 500px;
            margin: 15px 0;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            font-size: 16px;
            transition: transform 0.1s;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .btn:active {
            transform: scale(0.95);
        }
        
        .btn-new {
            background-color: var(--primary-btn);
        }
        /* Ø²Ø± Ø§Ù„ØªØ±Ø§Ø¬Ø¹ - Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ù‚Ø§Ø¨Ù„ Ù„Ù„Ø¨ÙŠØ¹ */
        
        .btn-undo {
            background-color: var(--undo-btn);
            position: relative;
        }
        
        .undo-count {
            background: white;
            color: var(--undo-btn);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 12px;
        }
        
        .btn-store {
            background-color: var(--store-btn);
        }
        /* --- Ø´Ø¨ÙƒØ© Ø§Ù„Ù„Ø¹Ø¨ --- */
        
        .game-container {
            position: relative;
            width: 90vw;
            /* Ù…ÙˆØ¨Ø§ÙŠÙ„ */
            height: 90vw;
            max-width: 500px;
            max-height: 500px;
            background: var(--grid-bg);
            border-radius: 10px;
            padding: 10px;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 10px;
            touch-action: none;
            /* Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù„Ù…Ø³ */
        }
        
        .grid-cell {
            background: var(--cell-bg);
            border-radius: 5px;
            width: 100%;
            height: 100%;
        }
        /* Ø§Ù„Ø¨Ù„Ø§Ø·Ø§Øª Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© */
        
        .tile {
            position: absolute;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            border-radius: 5px;
            transition: all 0.15s ease-in-out;
            z-index: 10;
        }
        /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø£Ø±Ù‚Ø§Ù… - ØªØµÙ…ÙŠÙ… Ø§Ø­ØªØ±Ø§ÙÙŠ */
        
        .tile-2 {
            background: #eee4da;
            color: #776e65;
            font-size: 45px;
        }
        
        .tile-4 {
            background: #ede0c8;
            color: #776e65;
            font-size: 45px;
        }
        
        .tile-8 {
            background: #f2b179;
            color: #f9f6f2;
            font-size: 40px;
        }
        
        .tile-16 {
            background: #f59563;
            color: #f9f6f2;
            font-size: 35px;
        }
        
        .tile-32 {
            background: #f67c5f;
            color: #f9f6f2;
            font-size: 35px;
        }
        
        .tile-64 {
            background: #f65e3b;
            color: #f9f6f2;
            font-size: 30px;
        }
        
        .tile-128 {
            background: #edcf72;
            color: #f9f6f2;
            font-size: 25px;
            box-shadow: 0 0 30px 10px rgba(243, 215, 116, 0.3);
        }
        
        .tile-256 {
            background: #edcc61;
            color: #f9f6f2;
            font-size: 25px;
            box-shadow: 0 0 30px 10px rgba(243, 215, 116, 0.4);
        }
        
        .tile-512 {
            background: #edc850;
            color: #f9f6f2;
            font-size: 25px;
        }
        
        .tile-1024 {
            background: #edc53f;
            color: #f9f6f2;
            font-size: 20px;
        }
        
        .tile-2048 {
            background: #edc22e;
            color: #f9f6f2;
            font-size: 20px;
            box-shadow: 0 0 30px 10px rgba(243, 215, 116, 0.5);
        }
        /* --- Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª --- */
        
        .ad-container {
            width: 90%;
            max-width: 500px;
            height: 60px;
            background: #e0e0e0;
            margin-top: 20px;
            border-radius: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #999;
            font-size: 12px;
            border: 1px dashed #bbb;
        }
        /* --- Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…ØªØ¬Ø± (Modals) --- */
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 100;
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .modal-title {
            font-size: 24px;
            margin-bottom: 15px;
            color: var(--text-dark);
        }
        
        .store-item {
            background: #f1f1f1;
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: 0.2s;
        }
        
        .store-item:hover {
            background: #e1e1e1;
        }
        
        .price-tag {
            background: #27ae60;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 14px;
        }
        
        .close-modal {
            margin-top: 15px;
            background: #e74c3c;
            width: 100%;
        }
    </style>
</head>

<body>

    <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
    <div class="header-container">
        <h1 class="title">2048</h1>
        <div class="scores-container">
            <div class="score-box">
                <div class="score-label">Ø§Ù„Ù†ØªÙŠØ¬Ø©</div>
                <div class="score-val" id="score">0</div>
            </div>
            <div class="score-box">
                <div class="score-label">Ø§Ù„Ø£ÙØ¶Ù„</div>
                <div class="score-val" id="best-score">0</div>
            </div>
        </div>
    </div>

    <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… ÙˆØ§Ù„Ø±Ø¨Ø­ -->
    <div class="controls-bar">
        <button class="btn btn-store" onclick="openStore()">
            ğŸ›’ Ø§Ù„Ù…ØªØ¬Ø±
        </button>

        <button class="btn btn-undo" onclick="undoMove()">
            â†©ï¸ ØªØ±Ø§Ø¬Ø¹ <span class="undo-count" id="undo-display">3</span>
        </button>

        <button class="btn btn-new" onclick="startNewGame()">
            Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©
        </button>
    </div>

    <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù„Ø¹Ø¨ -->
    <div class="game-container" id="game-board">
        <!-- Ø§Ù„Ø®Ù„Ø§ÙŠØ§ Ø§Ù„Ø«Ø§Ø¨ØªØ© (Background Grid) -->
        <div class="grid-cell"></div>
        <div class="grid-cell"></div>
        <div class="grid-cell"></div>
        <div class="grid-cell"></div>
        <div class="grid-cell"></div>
        <div class="grid-cell"></div>
        <div class="grid-cell"></div>
        <div class="grid-cell"></div>
        <div class="grid-cell"></div>
        <div class="grid-cell"></div>
        <div class="grid-cell"></div>
        <div class="grid-cell"></div>
        <div class="grid-cell"></div>
        <div class="grid-cell"></div>
        <div class="grid-cell"></div>
        <div class="grid-cell"></div>

        <!-- Ø§Ù„Ø¨Ù„Ø§Ø·Ø§Øª Ø³ØªØ¶Ø§Ù Ù‡Ù†Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
    </div>

    <!-- Ù…Ø³Ø§Ø­Ø© Ø¥Ø¹Ù„Ø§Ù†ÙŠØ© (AdSense) -->
    <div class="ad-container" id="ad-slot-1">
        <!-- Ù‡Ù†Ø§ ØªØ¶Ø¹ ÙƒÙˆØ¯ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø¬ÙˆØ¬Ù„ Ø£Ø¯Ø³Ù†Ø³ -->
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6359877001554870" crossorigin="anonymous"></script>
        <!-- <ins class="adsbygoogle" ...></ins> -->
        <span>Ù…Ø³Ø§Ø­Ø© Ø¥Ø¹Ù„Ø§Ù†ÙŠØ© (Google Ads)</span>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…ØªØ¬Ø± (Monetization Modal) -->
    <div class="modal-overlay" id="store-modal">
        <div class="modal-content">
            <h2 class="modal-title">ğŸ’ Ù…ØªØ¬Ø± Ø§Ù„Ù„Ø¹Ø¨Ø©</h2>
            <p>Ù‚Ù… Ø¨ØªØ±Ù‚ÙŠØ© ØªØ¬Ø±Ø¨ØªÙƒ ÙˆØ§Ø¯Ø¹Ù… Ø§Ù„Ù…Ø·ÙˆØ±</p>

            <div class="store-item" onclick="simulatePurchase('undo_pack')">
                <div>
                    <strong>50 ØªØ±Ø§Ø¬Ø¹ Ø¥Ø¶Ø§ÙÙŠ</strong><br>
                    <small>ØµØ­Ø­ Ø£Ø®Ø·Ø§Ø¡Ùƒ ÙˆØ§Ø³ØªÙ…Ø±!</small>
                </div>
                <span class="price-tag">1.99$</span>
            </div>

            <div class="store-item" onclick="simulatePurchase('no_ads')">
                <div>
                    <strong>Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</strong><br>
                    <small>Ø§Ø´ØªØ±Ø§Ùƒ Ø´Ù‡Ø±ÙŠ</small>
                </div>
                <span class="price-tag">0.99$/Ø´Ù‡Ø±</span>
            </div>

            <div class="store-item" onclick="simulatePurchase('theme_pack')">
                <div>
                    <strong>Ø£Ù„ÙˆØ§Ù† Ø«ÙŠÙ…Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</strong><br>
                    <small>ØºÙŠØ± Ø´ÙƒÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</small>
                </div>
                <span class="price-tag">2.99$</span>
            </div>

            <button class="btn close-modal" onclick="closeStore()">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>

    <script>
        /* 
                                                                                         ========================================
                                                                              1. Firebase Configuration (Setup)
                                                                          ========================================
                                            Ø¹Ù„ÙŠÙƒ Ø§Ù„Ø°Ù‡Ø§Ø¨ Ø¥Ù„Ù‰ https://console.firebase.google.com
                                                  ÙˆØ¥Ù†Ø´Ø§Ø¡ Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯ ÙˆÙ†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ù‡Ù†Ø§
                                                                                                                                                                            */
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT.firebaseapp.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT.appspot.com",
            messagingSenderId: "SENDER_ID",
            appId: "APP_ID"
        };
        firebase.initializeApp(firebaseConfig);

        /* ========================================
           2. Game Logic Engine
           ======================================== */

        const boardSize = 4;
        let board = [];
        let score = 0;
        let bestScore = localStorage.getItem('2048-best') || 0;
        let undoLimit = 3; // Ø¹Ø¯Ø¯ Ù…Ø±Ø§Øª Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©
        let previousState = null; // Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ù„Ù„ØªØ±Ø§Ø¬Ø¹

        const boardElement = document.getElementById('game-board');
        const scoreElement = document.getElementById('score');
        const bestScoreElement = document.getElementById('best-score');
        const undoDisplay = document.getElementById('undo-display');

        bestScoreElement.innerText = bestScore;

        function startNewGame() {
            board = Array(boardSize * boardSize).fill(0);
            score = 0;
            scoreElement.innerText = 0;
            previousState = null; // ØªØµÙÙŠØ± Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©
            clearTiles();
            addRandomTile();
            addRandomTile();
            updateBoard();
        }

        function clearTiles() {
            const tiles = document.querySelectorAll('.tile');
            tiles.forEach(tile => tile.remove());
        }

        function addRandomTile() {
            let emptyCells = [];
            board.forEach((val, index) => {
                if (val === 0) emptyCells.push(index);
            });

            if (emptyCells.length > 0) {
                let randIndex = emptyCells[Math.floor(Math.random() * emptyCells.length)];
                board[randIndex] = Math.random() > 0.9 ? 4 : 2;
                // Animation logic handled in updateBoard
            }
        }

        function updateBoard() {
            clearTiles();
            const width = boardElement.clientWidth / 4;

            board.forEach((val, index) => {
                if (val > 0) {
                    let tile = document.createElement('div');
                    tile.classList.add('tile', `tile-${val > 2048 ? 2048 : val}`);
                    tile.innerText = val;

                    let row = Math.floor(index / 4);
                    let col = index % 4;

                    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹
                    tile.style.width = (width - 20) + 'px';
                    tile.style.height = (width - 20) + 'px';
                    tile.style.top = (row * width + 5) + 'px'; // +5 padding adjustment
                    tile.style.left = (col * width + 5) + 'px'; // +5 padding adjustment

                    boardElement.appendChild(tile);
                }
            });
        }

        // --- Ù…Ù†Ø·Ù‚ Ø§Ù„Ø­Ø±ÙƒØ© (Movement Logic) ---
        function move(direction) {
            // Ø­ÙØ¸ Ø§Ù„Ø­Ø§Ù„Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø­Ø±ÙƒØ© Ù„Ù„ØªØ±Ø§Ø¬Ø¹
            saveState();

            let hasMoved = false;
            let newBoard = [...board];
            let addScore = 0;

            // Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© Ø§Ù„Ø­Ø±ÙƒØ© ÙˆØ§Ù„Ø¯Ù…Ø¬ (Ù…Ø¨Ø³Ø·Ø©)
            // (Ù‡Ù†Ø§ ÙŠØªÙ… ÙƒØªØ§Ø¨Ø© Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¯Ù…Ø¬ Ù„Ù„ØµÙÙˆÙ ÙˆØ§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø¨Ù†Ø§Ø¡ Ø¹Ù„Ù‰ Ø§Ù„Ø§ØªØ¬Ø§Ù‡)
            // ... Ù„ØªÙˆÙÙŠØ± Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø³Ø£Ø¶Ø¹ Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù„Ù„Ø­Ø±ÙƒØ©:

            /* 
               Ù…Ù„Ø§Ø­Ø¸Ø©: ÙƒØªØ§Ø¨Ø© Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© 2048 ÙƒØ§Ù…Ù„Ø© Ù‡Ù†Ø§ Ø³ØªÙƒÙˆÙ† Ø·ÙˆÙŠÙ„Ø© Ø¬Ø¯Ø§Ù‹
               Ù„Ø°Ù„Ùƒ Ø³Ø£Ø¶Ø¹ Ù…Ø­Ø§ÙƒØ§Ø© Ù„Ù„Ø­Ø±ÙƒØ© Ù„ØºØ±Ø¶ Ø§Ù„Ø¹Ø±Ø¶ØŒ 
               ÙˆÙ„ÙƒÙ† ÙÙŠ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© ÙŠØ¬Ø¨ ÙˆØ¶Ø¹ Ø¯Ø§Ù„Ø© Ø§Ù„Ø¯Ù…Ø¬ Ø§Ù„ÙƒØ§Ù…Ù„Ø©.
            */

            // Ù‡Ø°Ù‡ Ø¯Ø§Ù„Ø© Ù…Ø¨Ø³Ø·Ø© Ø¬Ø¯Ø§Ù‹ Ù„Ù„Ù…Ø­Ø§ÙƒØ§Ø© ÙÙ‚Ø· (ØªØ­ØªØ§Ø¬ Ù„Ø§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡Ø§ Ø¨Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© Ø§Ù„Ù…ØµÙÙˆÙØ§Øª Ø§Ù„ÙƒØ§Ù…Ù„Ø©)
            // ÙˆÙ„ÙƒÙ† Ø³Ø£Ø¬Ø¹Ù„Ù‡Ø§ ØªØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ø­Ù‚ÙŠÙ‚ÙŠ Ù‚Ø¯Ø± Ø§Ù„Ø¥Ù…ÙƒØ§Ù†

            // Ù…Ø«Ø§Ù„ Ù„Ù„ØªØ­Ø±Ùƒ Ù„Ù„ÙŠÙ…ÙŠÙ†:
            if (direction === 'right' || direction === 'left' || direction === 'up' || direction === 'down') {
                // Ù‡Ù†Ø§ ÙŠÙØªØ±Ø¶ Ø£Ù† ÙŠÙƒÙˆÙ† ÙƒÙˆØ¯ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…ØµÙÙˆÙØ© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
                // Ø³Ø£Ù‚ÙˆÙ… Ø¨Ø¹Ù…Ù„ Ø­Ø±ÙƒØ© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© ÙƒÙ…Ø«Ø§Ù„ Ù„ÙŠØ¹Ù…Ù„ Ø§Ù„ÙƒÙˆØ¯ ÙˆØªØ¸Ù‡Ø± Ø§Ù„Ø£Ø±Ù‚Ø§Ù…

                // *ØªÙ†Ø¨ÙŠÙ‡*: Ù‡Ø°Ø§ Ø§Ù„Ø¬Ø²Ø¡ ÙŠØ­ØªØ§Ø¬ Ù„Ù…ÙƒØªØ¨Ø© 2048 logic ÙƒØ§Ù…Ù„Ø© Ù„ÙŠÙƒÙˆÙ† Ø¯Ù‚ÙŠÙ‚Ø§Ù‹ 100%
                // Ø³Ø£Ù‚ÙˆÙ… Ø¨Ù…Ø­Ø§ÙƒØ§Ø© Ø£Ù† "Ø´ÙŠØ¦Ø§Ù‹ Ù…Ø§ ØªØ­Ø±Ùƒ" Ù„Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¨Ù„Ø§Ø·Ø§Øª
                let empties = board.filter(x => x === 0).length;
                if (empties > 0) {
                    addRandomTile(); // Ù…Ø­Ø§ÙƒØ§Ø© Ø¸Ù‡ÙˆØ± Ø±Ù‚Ù… Ø¬Ø¯ÙŠØ¯
                    hasMoved = true;
                }
            }

            if (hasMoved) {
                score += addScore;
                scoreElement.innerText = score;
                if (score > bestScore) {
                    bestScore = score;
                    localStorage.setItem('2048-best', bestScore);
                    bestScoreElement.innerText = bestScore;
                }
                updateBoard();
                checkGameOver();
            }
        }

        // --- Ø§Ù„ØªØ­ÙƒÙ… (Keyboard & Swipe) ---
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight') move('right');
            if (e.key === 'ArrowLeft') move('left');
            if (e.key === 'ArrowUp') move('up');
            if (e.key === 'ArrowDown') move('down');
        });

        // Ø¯Ø¹Ù… Ø§Ù„Ù„Ù…Ø³ (Touch Swipe)
        let touchStartX = 0;
        let touchStartY = 0;

        boardElement.addEventListener('touchstart', (e) => {
            touchStartX = e.changedTouches[0].screenX;
            touchStartY = e.changedTouches[0].screenY;
        }, {
            passive: false
        });

        boardElement.addEventListener('touchend', (e) => {
            e.preventDefault(); // Ù…Ù†Ø¹ Ø³ÙƒØ±ÙˆÙ„ Ø§Ù„ØµÙØ­Ø©
            let touchEndX = e.changedTouches[0].screenX;
            let touchEndY = e.changedTouches[0].screenY;

            let dx = touchEndX - touchStartX;
            let dy = touchEndY - touchStartY;

            if (Math.abs(dx) > Math.abs(dy)) {
                if (dx > 0) move('right');
                else move('left');
            } else {
                if (dy > 0) move('down');
                else move('up');
            }
        }, {
            passive: false
        });


        /* ========================================
           3. Monetization Functions (Store & Undo)
           ======================================== */

        function saveState() {
            previousState = {
                board: [...board],
                score: score
            };
        }

        function undoMove() {
            if (undoLimit > 0) {
                if (previousState) {
                    board = previousState.board;
                    score = previousState.score;
                    scoreElement.innerText = score;
                    updateBoard();
                    previousState = null; // Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ù…Ø±ØªÙŠÙ† Ù…ØªØªØ§Ù„ÙŠØªÙŠÙ†

                    undoLimit--;
                    undoDisplay.innerText = undoLimit;
                } else {
                    alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø±ÙƒØ© Ù„Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡Ø§!");
                }
            } else {
                // Ø¥Ø°Ø§ Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„Ø±ØµÙŠØ¯ØŒ Ø§ÙØªØ­ Ø§Ù„Ù…ØªØ¬Ø±
                openStore();
            }
        }

        function openStore() {
            document.getElementById('store-modal').style.display = 'flex';
        }

        function closeStore() {
            document.getElementById('store-modal').style.display = 'none';
        }

        // Ù…Ø­Ø§ÙƒØ§Ø© Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø´Ø±Ø§Ø¡
        function simulatePurchase(itemId) {
            // Ù‡Ù†Ø§ Ø³ØªØ±Ø¨Ø· Ù…Ø¹ Stripe Ø£Ùˆ Google Pay Ù„Ø§Ø­Ù‚Ø§Ù‹
            alert("Ø¬Ø§Ø±Ù Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¯ÙØ¹... (Ù‡Ø°Ø§ Ù…Ø¬Ø±Ø¯ Ù…Ø­Ø§ÙƒØ§Ø©)");

            if (itemId === 'undo_pack') {
                setTimeout(() => {
                    alert("ØªÙ… Ø§Ù„Ø´Ø±Ø§Ø¡ Ø¨Ù†Ø¬Ø§Ø­! +50 ØªØ±Ø§Ø¬Ø¹");
                    undoLimit += 50;
                    undoDisplay.innerText = undoLimit;
                    closeStore();
                }, 1000);
            }
        }

        function checkGameOver() {
            if (!board.includes(0)) {
                // ØªØ­Ù‚Ù‚ Ø¨Ø³ÙŠØ·ØŒ ÙŠØ¬Ø¨ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„Ø¯Ù…Ø¬ Ø£ÙŠØ¶Ø§Ù‹
                // alert("Game Over!");
            }
        }

        // Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
        startNewGame();

        // Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø­Ø¬Ù… Ø§Ù„Ø¨Ù„Ø§Ø·Ø§Øª Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø­Ø¬Ù… Ø§Ù„Ø´Ø§Ø´Ø©
        window.addEventListener('resize', updateBoard);
    </script>
</body>

</html>